from geopy.distance import geodesic

# Yaroslavl locations
LOCATIONS = {
    'attractions': {
        "Ярославский Кремль": {
            "description": "Ярославский Кремль (Спасо-Преображенский монастырь)\nАдрес: Богоявленская площадь, 25\nРежим: Пн–Вс 09:40–18:00",
            "lat": 57.620823, "lon": 39.889932
        },
        "Церковь Ильи Пророка": {
            "description": "Церковь Ильи Пророка\nАдрес: Советская площадь, 7\nРежим: Пн–Вс 10:00–17:00 (летом)",
            "lat": 57.626759, "lon": 39.894358
        },
        "Памятник Ярославу Мудрому": {
            "description": "Памятник Ярославу Мудрому\nАдрес: Богоявленская площадь",
            "lat": 57.622459, "lon": 39.887001
        },
        "Стрелка": {
            "description": "Стрелка (слияние Волги и Которосли)\nАдрес: Которосльная набережная",
            "lat": 57.622626, "lon": 39.901413
        },
        "Успенский собор": {
            "description": "Успенский собор\nАдрес: Которосльная наб., 2/1\nРежим: Пн–Вс 08:00–19:00\n\nБогослужения:\n• Будни: 08:00, 17:00\n• Вс и праздники: 07:00, 09:00, 17:00",
            "lat": 57.622415, "lon": 39.902063
        },
        "Музей истории Ярославля": {
            "description": "Музей истории Ярославля\nАдрес: Волжская наб., 17\nРежим: Ср–Вс 10:00–18:00\n\nСтоимость:\n• Взрослый билет: 250 ₽\n• Студенты/пенсионеры: 120 ₽\n• Дети до 16 лет: бесплатно",
            "lat": 57.625184, "lon": 39.895557
        }
    },
    'trauma_centers': {
        "Травмпункт №1": {
            "description": "Травмпункт №1\nАдрес: ул. Загородный сад, 11\nТел: (4852) 73-52-69\nРежим: круглосуточно",
            "lat": 57.639066, "lon": 39.864055
        },
        "Травмпункт №2": {
            "description": "Травмпункт №2\nАдрес: просп. Октября, 52\nТел: (4852) 73-56-42\nРежим: круглосуточно",
            "lat": 57.637077, "lon": 39.862270
        },
        "Травмпункт №3": {
            "description": "Травмпункт №3\nАдрес: ул. Носкова, 8\nТел: (4852) 45-04-09\nРежим: круглосуточно",
            "lat": 57.608492, "lon": 39.838315
        },
        "Травмпункт №4": {
            "description": "Травмпункт №4\nАдрес: ул. Чехова, 39\nТел: (4852) 25-07-07\nРежим: Пн–Вс 08:00–20:00",
            "lat": 57.639116, "lon": 39.864551
        }
    },
    'parks': {
        "Даманский парк": {
            "description": "Парк на Даманском острове\nАдрес: Даманский остров\nРежим: круглосуточно\n\nℹ️ Информация:\n• Площадь: 15 гектаров\n• Детские площадки\n• Спортивные зоны\n• Велосипедные дорожки\n• Зимой: каток",
            "lat": 57.618316, "lon": 39.899573
        },
        "Парк 1000-летия": {
            "description": "Парк 1000-летия Ярославля\nАдрес: ул. Панина, 7\nРежим: круглосуточно\n\nℹ️ Информация:\n• Площадь: 24 гектара\n• Аттракционы\n• Спортивные площадки\n• Велосипедные дорожки\n• Зимой: каток, горки",
            "lat": 57.617297, "lon": 39.871399
        },
        "Парк Нефтяник": {
            "address": "ул. Павлова, 2Б",
            "working_hours": "Ежедневно 11:00–21:00",
            "lat": 57.584213, "lon": 39.869594,
            "description": "Живописный парк в Красноперекопском районе города, на территории парка есть все условия для занятий спортом и семейного отдыха.",
            "image": "https://i.ibb.co/LzdX4z2/neftyanik-park.jpg"
        },
        "Демидовский сад": {
            "address": "пл. Челюскинцев",
            "working_hours": "Круглосуточно",
            "lat": 57.625181, "lon": 39.897056,
            "description": "Сквер в историческом центре города Ярославля, на площади Челюскинцев. Входит в перечень особо охраняемых природных территорий Ярославской области.",
            "image": "https://i.ibb.co/m0fW2P9/demidovsky-garden.jpg"
        },
        "Петропавловский парк": {
            "address": "ул. 2-я Петропавловская",
            "working_hours": "Пн–Вс 08:00–20:00",
            "lat": 57.599444, "lon": 39.845000,
            "description": "Один из старейших парков в Ярославле, находящийся в южной части города на бывшей территории Ярославской Большой мануфактуры (Полотняного двора).",
            "image": "https://i.ibb.co/hK0Z4s8/petropavlovskiy-park.jpg"
        },
        "Павловский парк": {
            "address": "Дзержинский район, 1-й м-н",
            "working_hours": "Круглосуточно",
            "lat": 57.629876, "lon": 39.862145,
            "description": "Живописный парк культуры и отдыха в Дзержинском районе Ярославля, любимое место отдыха ярославцев.",
            "image": "https://i.ibb.co/Lg3XyN7/pavlovskiy-park.jpg"
        }
    },
    'theaters': {
        "Театр им. Ф. Волкова": {
            "description": "Театр им. Ф. Волкова\nАдрес: пл. Волкова, 1\nТел: (4852) 72-74-04\nРежим: Пн–Вс 10:00–19:00",
            "lat": 57.627077, "lon": 39.884708
        },
        "Театр кукол": {
            "description": "Ярославский театр кукол\nАдрес: ул. Свободы, 23\nТел: (4852) 72-63-03\nРежим: Пн–Вс 10:00–18:00",
            "lat": 57.625007, "lon": 39.879943
        },
        "Камерный театр": {
            "description": "Камерный театр\nАдрес: ул. Свердлова, 9\nТел: (4852) 30-56-45\nРежим: Пн–Вс 12:00–19:00",
            "lat": 57.629113, "lon": 39.881033
        },
        "Театр юного зрителя": {
            "description": "Театр юного зрителя\nАдрес: ул. Свободы, 23\nТел: (4852) 33-31-97\nРежим: Пн–Вс 10:00–18:00",
            "lat": 57.624382, "lon": 39.875955
        }
    },
    'shopping_centers': {
        "ТРЦ Аура": {
            "description": "ТРЦ Аура\nАдрес: ул. Гагарина, 27\nРежим: Пн–Вс 10:00–22:00\nТел: (4852) 59-99-99\n\nℹ️ Информация:\n• 150+ магазинов\n• Фудкорт\n• Развлекательный центр\n• Детская площадка\n• Парковка",
            "lat": 57.627637, "lon": 39.871380
        },
        "ТРЦ Ривьера": {
            "description": "ТРЦ Ривьера\nАдрес: просп. Машиностроителей, 13А\nРежим: Пн–Вс 08:00–23:00",
            "lat": 57.648092, "lon": 39.953113
        },
        "ТРЦ Вернисаж": {
            "description": "ТРЦ Ярославский Вернисаж\nАдрес: Дорожная ул., 6А\nРежим: Пн–Вс 10:00–22:00",
            "lat": 57.571068, "lon": 39.842483
        },
        "ТРЦ Космос": {
            "description": "ТРЦ Космос\nАдрес: Ленинградский просп., 49А\nРежим: Пн–Вс 10:00–21:00",
            "lat": 57.679741, "lon": 39.791834
        },
        "ТРЦ РИО": {
            "description": "ТРЦ РИО\nАдрес: Тутаевское ш., 1\nРежим: Пн–Вс 09:00–21:00",
            "lat": 57.670166, "lon": 39.837681
        },
        "ТРЦ Яркий": {
            "description": "ТРЦ Яркий\nАдрес: просп. Машиностроителей, 30/18\nРежим: Пн–Вс 10:00–21:00",
            "lat": 57.645544, "lon": 39.953417
        }
    }
}

def get_nearest_location(lat, lon, category):
    """Find the nearest location in a given category."""
    if category not in LOCATIONS:
        return None
    
    user_location = (lat, lon)
    nearest = None
    min_distance = float('inf')
    
    for name, data in LOCATIONS[category].items():
        location = (data['lat'], data['lon'])
        distance = geodesic(user_location, location).kilometers
        
        if distance < min_distance:
            min_distance = distance
            nearest = {
                'name': name,
                'description': data['description'],
                'distance': round(distance, 2)
            }
    
    return nearest

def get_locations_by_category(category):
    """Get all locations in a given category."""
    return LOCATIONS.get(category, {})

def get_location_info(category, name):
    """Get information about a specific location."""
    return LOCATIONS.get(category, {}).get(name) 